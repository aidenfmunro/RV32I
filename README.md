
# RV32I ü§åüòÆ‚Äçüí®
–ú–∞–ª–µ–Ω—å–∫–æ–µ, –Ω–æ **–¥–µ—Ä–∑–∫–æ–µ** —è–¥—Ä–æ-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –¥–ª—è RISC-V RV32.
–ù–µ —ç–º—É–ª—è—Ç–æ—Ä ‚Äî –∞ **—Å–∏–º—É–ª—è—Ç–æ—Ä —Å–∞–º–æ–π –ª—É—á—à–µ–π, –æ—Ç–∫—Ä—ã—Ç–æ–π –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã RISC-V** üòÆ‚Äçüí®

---

## –ö–∞–∫ –∑–∞–±—Ä–∞—Ç—å —ç—Ç–æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –≤ —Å–≤–æ—é –ø–∞–ø–∫—É

```bash
git clone --recurse-submodules https://github.com/aidenfmunro/RV32I.git
````

---

## –ö–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —ç—Ç–∞ —à—Ç—É–∫–∞ –≤–æ–æ–±—â–µ –ø–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–µ—Ç

–Ø–¥—Ä–æ –Ω–∞—Ü–µ–ª–µ–Ω–æ –Ω–∞ **RISC-V 32-bit base integer ISA**, –ø–ª—é—Å –Ω–µ–º–Ω–æ–≥–æ –≤–∫—É—Å–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.

–¢–µ–∫—É—â–∏–π –±–∏–ª–¥-–∫–æ–Ω—Ñ–∏–≥ (–∫–∞–∫ –≤ e2e —Ç–µ—Å—Ç–∞—Ö –∏ —Ñ–ª–∞–≥–∞—Ö —Ç—É–ª—á–µ–π–Ω–∞: `-march=rv32imf_zbb`):

* **RV32I** ‚Äî –±–∞–∑–∞, –±–µ–∑ –Ω–µ—ë –Ω–∏–∫—É–¥–∞ üß±
* **M** ‚Äî —É–º–Ω–æ–∂–µ–Ω–∏–µ/–¥–µ–ª–µ–Ω–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ä—É–∫–∞–º–∏ —Å—á–∏—Ç–∞—Ç—å –º—ã –Ω–µ –±—É–¥–µ–º üßÆ
* **F** ‚Äî float‚Äô—ã ‚ò∫Ô∏è Ô∏è
* **Zbb** ‚Äî bit-manip, —á—Ç–æ–±—ã –ø–æ–±–∏—Ç–æ–≤–æ —â—ë–ª–∫–∞—Ç—å –∫–∞–∫ –æ—Ä–µ—à–∫–∏ ü•ú

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –æ–Ω–æ –≤–æ–æ–±—â–µ –∑–∞–≤–µ–ª–æ—Å—å

* **CMake ‚â• 3.20** (—Å—Ç–∞—Ä–∏—á–∫–æ–≤ –Ω–µ –±–µ—Ä—ë–º)

* **C++20 –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä** (GCC / Clang / MSVC ‚Äî –∫—Ç–æ –≤—ã–∂–∏–ª, —Ç–æ—Ç –∏ –º–æ–ª–æ–¥–µ—Ü)

* **RISC-V cross toolchain** (—á—Ç–æ–±—ã –∫–æ–º–ø–∏–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π RISC-V):

  * `riscv64-unknown-elf-gcc`
  * `riscv64-unknown-elf-as`

  –û–±–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `PATH`, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ ‚Äú–Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –Ω–æ —Ç—ã –¥–µ—Ä–∂–∏—Å—å‚Äù.

* **GoogleTest**, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–∞–∫, —á—Ç–æ–±—ã CMake –µ–≥–æ –Ω–∞—à—ë–ª (—á–µ—Ä–µ–∑ config package –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω–æ)

---

## –†–µ–∂–∏–º—ã —Å–±–æ—Ä–∫–∏ (aka ‚Äú–∫–∞–∫ —Å–∏–ª—å–Ω–æ —Ç—ã —Ö–æ—á–µ—à—å —Å—Ç—Ä–∞–¥–∞—Ç—å‚Äù)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ProjectOptions.cmake` —Å –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–º–∏ –¥–µ—Ñ–æ–ª—Ç–∞–º–∏:

### Debug ü™ì

* `-Og -g3 -fno-omit-frame-pointer`
* –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä—ã (ASan/UBSan/TSan), —á—Ç–æ–±—ã –ª–æ–≤–∏—Ç—å –±–∞–≥–∏, –ø–æ–∫–∞ –æ–Ω–∏ –µ—â—ë –º–∞–ª–µ–Ω—å–∫–∏–µ

### Release üöÄ

* `-O3` + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ IPO/LTO, —á—Ç–æ–±—ã –±—ã–ª–æ –±—ã—Å—Ç—Ä–æ –∏ –∫—Ä–∞—Å–∏–≤–æ

---

## –°–±–æ—Ä–∫–∞ Debug (—Ä–µ–∂–∏–º ‚Äú–ø–æ–π–º–∞—Ç—å –±–∞–≥ –∑–∞ —Ö–≤–æ—Å—Ç‚Äù)

–ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:

```bash
cmake -S . -B build/debug \
  -DCMAKE_BUILD_TYPE=Debug \
  -DRV32I_ENABLE_TESTS=ON

cmake --build build/debug -j
```

–ß—Ç–æ –ø–æ—è–≤–∏—Ç—Å—è:

* `build/debug/rv32i` ‚Äî CLI –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä (–≥–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π)
* `build/debug/tests/rv32i_tests` ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–π –±–∏–Ω–∞—Ä—å (–±–æ—Å—Å-—Ñ–∞–π—Ç)
* `build/debug/tests/e2e_bins/*.rv32` ‚Äî —Å–∫–æ–º–ø–∏–ª–µ–Ω–Ω—ã–µ RISC-V —Ç–µ—Å—Ç-–ø—Ä–æ–≥–∏ –¥–ª—è e2e

### Debug + —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä—ã (—Ä–µ–∂–∏–º ‚Äú–∫–∞–∂–¥—ã–π –±–∞–π—Ç –ø–æ–¥ –ø—Ä–∏—Å–º–æ—Ç—Ä–æ–º‚Äù)

–ù–∞–ø—Ä–∏–º–µ—Ä ASan + UBSan:

```bash
cmake -S . -B build/debug-asan \
  -DCMAKE_BUILD_TYPE=Debug \
  -DRV32I_ENABLE_TESTS=ON \
  -DRV32I_ENABLE_ASAN=ON \
  -DRV32I_ENABLE_UBSAN=ON

cmake --build build/debug-asan -j
```

> ‚ö†Ô∏è –ï—Å–ª–∏ —É —Ç–µ–±—è `LD_PRELOAD` –≤—ã—Å—Ç–∞–≤–ª–µ–Ω ‚Äî –æ–Ω –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å ASan.
> –ò–Ω–æ–≥–¥–∞ –ø–æ–º–æ–≥–∞–µ—Ç `unset LD_PRELOAD` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º.

---

## –°–±–æ—Ä–∫–∞ Release (—Ä–µ–∂–∏–º ‚Äú–ª–µ—Ç–∏—Ç –∫–∞–∫ —Ä–∞–∫–µ—Ç–∞‚Äù)

```bash
cmake -S . -B build/release \
  -DCMAKE_BUILD_TYPE=Release

cmake --build build/release -j
```

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `rv32i` –æ–∫–∞–∂–µ—Ç—Å—è –≤ `build/release/`.

–ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å IPO/LTO (–æ–ø—Ü–∏—è `RV32I_ENABLE_IPO=ON`, –æ–±—ã—á–Ω–æ —ç—Ç–æ –∏ —Ç–∞–∫ –¥–µ—Ñ–æ–ª—Ç), —á—Ç–æ–±—ã –µ—â—ë —á—É—Ç—å-—á—É—Ç—å ‚Äú–≥–∞–∑–∞–Ω—É—Ç—å‚Äù.

---

## –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ (–º–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã)

–ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏:

```bash
./build/release/rv32i <path/to/program>
```

–ó–∞–≥—Ä—É–∂–∞–µ—Ç **RISC-V ELF** –∏ –∏—Å–ø–æ–ª–Ω—è–µ—Ç –µ–≥–æ.
–î–∞, –∫–∞–∫ –≤–∑—Ä–æ—Å–ª—ã–π.

---

## –¢–µ—Å—Ç—ã (—á—Ç–æ–±—ã –Ω–µ ‚Äú—Ä–∞–±–æ—Ç–∞–µ—Ç —É –º–µ–Ω—è‚Äù)

### –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä–∫—É —Ç–µ—Å—Ç–æ–≤

–¢–µ—Å—Ç—ã –≤—ã–∫–ª—é—á–µ–Ω—ã –æ–ø—Ü–∏–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```cmake
option(RV32I_ENABLE_TESTS "Build unit tests" OFF)
```

–ü–æ—ç—Ç–æ–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º —Ç–∞–∫:

```bash
cmake -S . -B build/debug \
  -DCMAKE_BUILD_TYPE=Debug \
  -DRV32I_ENABLE_TESTS=ON
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
ctest --test-dir build/debug/tests
# –∏–ª–∏
./build/debug/tests/rv32i_tests
```

–í–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –±–∏–Ω–∞—Ä—è –∂–∏–≤—É—Ç –∏ **unit**, –∏ **e2e** —Ç–µ—Å—Ç—ã.

---

## Unit tests (—Ä–µ–∂–∏–º ‚Äú–ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏‚Äù)

–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –º—ã –±–µ—Ä—ë–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, **–∫–æ–¥–∏—Ä—É–µ–º**, **–¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–º**, –∏ —Å–º–æ—Ç—Ä–∏–º:
‚Äú–¢—ã –≤–æ–æ–±—â–µ —Ç–æ —Å–¥–µ–ª–∞–ª –∏–ª–∏ –æ–ø—è—Ç—å —Ñ–∞–Ω—Ç–∞–∑–∏—Ä—É–µ—à—å?‚Äù

---

## End-to-End tests (—Ä–µ–∂–∏–º ‚Äú–Ω–∞—Å—Ç–æ—è—â–∞—è –∂–∏–∑–Ω—å‚Äù)

E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –≤ 2 —ç—Ç–∞–ø–∞:

### 1) –°–æ–±–∏—Ä–∞–µ–º RISC-V –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏–∑ C –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤

–ò—Å—Ö–æ–¥–Ω–∏–∫–∏ –ª–µ–∂–∞—Ç –≤ `tests/e2e/*.c`, —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∫—Ä–æ—Å—Å-—Ç—É–ª—á–µ–π–Ω–æ–º —á–µ—Ä–µ–∑ –æ–±—â–∏–π API:

* `source/common/api.s`, `api.h`, `lib.h` –¥–∞—é—Ç:

  * syscall-–æ–±—ë—Ä—Ç–∫–∏: `read`, `write`, `exit`
  * –º–µ–ª–∫–∏–µ —Ö–µ–ª–ø–µ—Ä—ã: –ø–∞—Ä—Å–∏–Ω–≥ —á–∏—Å–µ–ª, –ø–µ—á–∞—Ç—å —á–∏—Å–µ–ª –∏ —Ç.–¥.

`tests/CMakeLists.txt` –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π `.c` –≤ `.rv32` –ø–æ–¥ `build/.../tests/e2e_bins/`.

### 2) –ü—Ä–æ–≥–æ–Ω—è–µ–º –∏—Ö —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –∏–∑ C++ (GTest)

–§–∞–π–ª `tests/source/e2e_tests.cpp`:

* –±–µ—Ä—ë—Ç –∫–∞–∂–¥—ã–π `.rv32` –±–∏–Ω–∞—Ä—å
* –∑–∞–ø—É—Å–∫–∞–µ—Ç —á–µ—Ä–µ–∑ `rv32i` (–ø—Ä–∏–º–µ—Ä: `echo 'input' | rv32i program.rv32`)
* –ª–æ–≤–∏—Ç stdout –∏ exit code
* —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å —ç—Ç–∞–ª–æ–Ω–æ–º (–æ–∂–∏–¥–∞–Ω–∏—è–º–∏)

---

## –ü—Ä–∏–º–µ—Ä—ã e2e –ø—Ä–æ–≥—Ä–∞–º–º (–ª–µ–≥–µ–Ω–¥—ã)

* `isqrt.c` ‚Äî —á–∏—Ç–∞–µ—Ç `n`, –ø–µ—á–∞—Ç–∞–µ—Ç `floor(sqrt(n))`
* `factorial.c` ‚Äî —á–∏—Ç–∞–µ—Ç `n`, –ø–µ—á–∞—Ç–∞–µ—Ç `n!`
* `bubblesort.c` ‚Äî —á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å–ø–∏—Å–æ–∫, –ø–µ—á–∞—Ç–∞–µ—Ç –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫

–ö–∞–∂–¥–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π API:

```c
#include "api.h"
#include "lib.h"
```

---

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é e2e –ø—Ä–æ–≥—Ä–∞–º–º—É (–¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç üß†)

1. –°–æ–∑–¥–∞–π `tests/e2e/<name>.c`, –ø–æ–¥–∫–ª—é—á–∏ `api.h` –∏ `lib.h`
2. –î–æ–±–∞–≤—å `<name>` –≤ —Å–ø–∏—Å–æ–∫ `E2E_PROGRAMS` –≤ `tests/CMakeLists.txt`
3. –î–æ–±–∞–≤—å `E2ETestCase{...}` –≤ `tests/source/e2e_tests.cpp` (–≤–≤–æ–¥/–≤—ã–≤–æ–¥ –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è)

–ü–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏–ª, –ø–µ—Ä–µ—Å–æ–±—Ä–∞–ª ‚Äî –∏ –Ω–æ–≤—ã–π —Ç–µ—Å—Ç —Å–∞–º –ø–æ–¥—Ç—è–Ω–µ—Ç—Å—è –∏ –ø—Ä–æ–≥–æ–Ω–∏—Ç—Å—è.

```

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –µ—â—ë —Å–¥–µ–ª–∞—Ç—å –≤–µ—Ä—Å–∏—é **–µ—â—ë –±–æ–ª–µ–µ –º–µ–º–Ω—É—é** (—Å ‚Äú–±–∞–≥–∞–º–∏ –∫–∞–∫ –ø–æ–∫–µ–º–æ–Ω–∞–º–∏‚Äù –∏ ‚ÄúASan –∫–∞–∫ –±–∞–±–∫–æ–π —Å —Ç–∞–ø–∫–æ–º‚Äù), –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç ‚Äú–º–µ–º–Ω–æ, –Ω–æ —á—É—Ç—å –±–æ–ª–µ–µ –ø—Ä–∏–ª–∏—á–Ω–æ –ø–æ–¥ GitHub‚Äù.
```
